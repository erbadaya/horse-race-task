<!DOCTYPE html>
<html>
  <head>
    <script src="https://unpkg.com/jspsych@7.3.3"></script>
    <script src="https://unpkg.com/@jspsych/plugin-call-function@1.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-survey-text"></script>
    <script src="https://unpkg.com/@jspsych/plugin-survey@0.2.1"></script>
    <script src="https://unpkg.com/@jspsych/plugin-survey-html-form@1.0.1"></script>
    <script src="https://unpkg.com/@jspsych/plugin-preload"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-audio-keyboard-response@1.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-audio-button-response@1.1.2"></script>
    <script src="./create-new-plugin/plugin-audio-survey-input-response.js"></script>
    <script src="./dist/plugin-instructions.js"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.2"></script>
    <link href="https://unpkg.com/jspsych@7.3.3/css/jspsych.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="https://unpkg.com/@jspsych/plugin-survey@0.2.1/css/survey.css">
  </head>
  <body></body>
  <script>
    /* initialize jsPsych */
    var jsPsych = initJsPsych({
      on_finish: function() {
        jsPsych.data.displayData();
      }
    });

    var timeline = [];

    // We need to check that they meet our criteria, otherwise they are re-directed outside of the experiment and back to Prolific where they are asked to return their submission
    // Alternatively we could do this on Testable and then re-direct them here? 

    var check_criteria = {
      type: jsPsychSurvey,
        pages: [
            [{type: 'text', prompt: 'What is your Prolific ID?', placeholder: "", name: 'prolific_id'}],
            [
                {type:'multi-choice',
                prompt: 'Were you born and raised in the United Kingdom?',
                options: ["Yes", "No"],
                correct_response: "Yes",
                required: true,
                name: 'uk_origin'},
              ],
              [{type:'multi-choice',
                prompt: 'Do you currently live in the United Kingdom?',
                options: ["No", "Yes"],
                correct_response: "Yes",
                required: true,
                name: 'uk_live'},],
              [{type:'multi-choice',
                prompt: 'Is English your first language? If you learnt any other language before the age of six, because someone spoke to you in a language other than English, the answer is \'No\'.',
                options: ["Yes", "No"],
                correct_response: "Yes",
                required: true,
                name: 'english_l1'},]
              ],
        on_finish: function(data){
            if(data.accuracy[0].uk_origin && data.accuracy[1].uk_live && data.accuracy[2].english_l1){
              proceed = 'yes'; // not working atm \_o.o_/
            } else {
              proceed = 'no';
            }
          }
    };


    var no_criteria = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: '<p> Unfortunately, you do not meet the criteria to take part in the experiment.<p>' +
            'Only participants who reported being born and raised, and currently residing in the United Kingdom, with English as a first language, and no knowledge of any other language on Prolific are allowed to take part in this experiment. <br> <br> Please, <a href="https://app.prolific.co/submissions/complete?cc=C8J1HJFX">click here to </a>return your submission on Prolific as the information you gave on the platform does not meet your answers to the questions in our experiment.'
    };

    var conditional_outcriteria = {
        timeline: [no_criteria],
        conditional_function: function(){
            if(proceed == 'yes'){
                return false;
            } else {
                return true;
            }
    }
    };

    var welcome_screen = {
      type: jsPsychInstructions,
      pages: [
        'In this experiment, you will listen to a series of speaker providing descriptions about horses. Because the experiment relies on you listening to audios, <b> it works best if you are in a quiet place, and wear headphones. </b> If you don\'t have headphones, earbuds or decent computer speakers would be helpful. <br> Please decide on what you are doing to use, and check that your sound is working properly, before continuing to the next page.'
      ],
      show_clickable_nav: true
    };

    // check that headphones are on
    var check_headphones = {
        type: jsPsychAudioButtonResponse,
        stimulus: 'adjust_volume.mp3',
        prompt: 'Please adjust your volume and follow the audio instruction. You will only hear this audio once.',
        choices: ['T', 'M', 'Q', 'H', 'X', 'W', 'S', 'P'],
        response_allowed_while_playing: false,
        on_finish: function(data) {
            if(data.response == 2){
              data.correct = true;
              headphones = 'yes' // not working atm \_o.o_/
            } else {
              data.correct = false;
              headphones = 'no'
            }
          }
    };

    var no_headphones = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: '<p> You failed the attention check as you did not follow the instructions in the audio.<p>' +
            'Please, <a href="https://app.prolific.co/submissions/complete?cc=CPA7W0TO">click here to </a>return your submission on Prolific.'
    };

    var conditional_outheadphones = {
        timeline: [no_headphones],
        conditional_function: function(){
            if(headphones == 'yes'){
                return false;
            } else {
                return true;
            }
        }
    };


    // introduce speakers

    var introduction_speakers = {
      type: jsPsychInstructions,
      pages: [
        'We have received information from the UK and Italy\'s leading horse racing tipsters, Lauren Waterstone and Marila Fiammetta, about the upcoming \'Scottish Flat Season Finale\' race next Monday, 16th October at Musselburgh Racecourse (Edinburgh). <br> Ms Waterstone and Ms Fiammetta are highly respected tipsters amongst the horse racing elites in the UK and Italy. Both have achieved an outstanding level of performance that marks them as the very best in the game. They currently stand undefeated, having had an unbeatable strike of consecutive wins since 2021. We are truly honoured to have received information from Ms Waterstone and Ms Fiammetta on the 4 most popular horses running at Musselburgh in October. Click \'NEXT\' to continue.'
      ],
      show_clickable_nav: true
    }



    jsPsych.run([check_criteria, conditional_outcriteria, welcome_screen, check_headphones, conditional_outheadphones]);
  </script>
</html>